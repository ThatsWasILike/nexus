<!DOCTYPE html>
<html>
<head>
  <title>Nexus Chat</title>
</head>
<body>
  <h1>Nexus Chat</h1>

  <div id="messages"></div>

  <input id="input" placeholder="Escribe un mensaje..." />
  <button id="send">Enviar</button>

  <br><br>

  <input type="file" id="fileInput">
  <button id="sendFile">Enviar Archivo</button>

  <script src="/socket.io/socket.io.js"></script>
  <script>
    const socket = io();

    const input = document.getElementById("input");
    const sendBtn = document.getElementById("send");
    const messages = document.getElementById("messages");

    sendBtn.onclick = () => {
      socket.emit("chat message", input.value);
      input.value = "";
    };

    socket.on("chat message", (msg) => {
      const div = document.createElement("div");
      div.innerHTML = msg;
      messages.appendChild(div);
    });

    // Enviar archivo
    document.getElementById("sendFile").onclick = async () => {
      const fileInput = document.getElementById("fileInput");
      const file = fileInput.files[0];

      if (!file) return;

      const formData = new FormData();
      formData.append("file", file);

      const res = await fetch("/upload", {
        method: "POST",
        body: formData
      });

      const data = await res.json();

      socket.emit(
        "chat message",
        `<a href="${data.fileUrl}" target="_blank">${data.originalName}</a>`
      );
    };
  </script>
</body>
</html>
